<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Data Integration Tool (DIT)</title>

    <!-- Bootstrap -->
    <link href="http://localhost:8000/static/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://localhost:8000/static/bootstrap-3.3.7-dist/css/bootstrap-theme.min.css" rel="stylesheet" id="bs-theme-stylesheet">
    <link href="http://localhost:8000/static/css/dashboard.css" rel="stylesheet">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script type='text/javascript' src="http://localhost:8000/static/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script type='text/javascript' src="http://localhost:8000/static/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script type='text/javascript'>
    $(document).ready(function(){
        $("[data-toggle=popover]").each(function(i, obj) {

            $(this).popover({
              html: true,
              content: function() {
                var id = $(this).attr('id')
                var contentId = '#' + id + '-content'
                return $(contentId).html();
              }
            });
        });
        $('[data-toggle="popover"]').popover();
    });

    function doCreate() {
        $('#saveForm').append($('#flowFilePath'));
        window.location.href = '/';
    }

    function doUpdate() {
        var config_path = $('#flowFilePath').val();
        var updateURLstring = '/update?config_file_path=' + config_path;
        console.log('config_path: ' + config_path + ',  updateURL: ' + updateURLstring);
        window.location.href = updateURLstring;
    }
    </script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
          <nav class="navbar navbar-inverse navbar-fixed-top">
            <div id="navbar" class="navbar-collapse collapse">
              <a class="navbar-brand" href="#">Data Integration Tool (DIT)</a>
            </div>
          </nav>
      </div>

      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
          <form class="navbar-form nav-sidebar">
            <input type="text" class="form-control" placeholder="Search for widget...">
          </form>
          <ul class="nav nav-sidebar">
            <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="collapse" data-target="#readerWidgetList" aria-expanded="false">Reader Widgets<span class="caret"></span></button>
            <ul class="nav nav-pills nav-stacked collapse" id="readerWidgetList">
               % for widget in configs['ReaderWidget']:
              <li>
                    <button type="button" class="btn btn-sm btn-block"
                        data-toggle="popover"
                        data-container="body"
                        data-placement="right"
                        id="${widget['name']}">
                        ${widget['name']}</button>
                    <div id="${widget['name']}-content" class="hide">
                        <p><b>Description:</b> ${widget['description']}</br>
                            % for in_key, in_val in [(key, widget[key]) for key in widget.keys() if 'input' in key]:
                                % if 'type' in in_key:
                                    <b>Type:</b> ${in_val}</br>
                                % else:
                                    <b>Input:</b> ${in_val}, 
                                % endif
                            % endfor
                    </div>
              </li>
              % endfor
            </ul>
          </ul>
          <ul class="nav nav-sidebar">
            <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="collapse" data-target="#writerWidgetList" aria-expanded="false">Writer Widgets<span class="caret"></span></button>
            <ul class="nav nav-pills nav-stacked collapse" id="writerWidgetList">
               % for widget in configs['WriterWidget']:
              <li>
                    <button type="button" class="btn btn-sm btn-block"
                        data-toggle="popover"
                        data-container="body"
                        data-placement="right"
                        id="${widget['name']}">
                        ${widget['name']}</button>
                    <div id="${widget['name']}-content" class="hide">
                        <p><b>Description:</b> ${widget['description']}</br>
                            % for in_key, in_val in [(key, widget[key]) for key in widget.keys() if 'input' in key]:
                                % if 'type' in in_key:
                                    <b>Type:</b> ${in_val}</br>
                                % else:
                                    <b>Input:</b> ${in_val}, 
                                % endif
                            % endfor
                    </div>
              </li>
              % endfor
            </ul>
          </ul>
          <ul class="nav nav-sidebar">
            <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="collapse" data-target="#manipulationWidgetList" aria-expanded="false">Manipulation Widgets<span class="caret"></span></button>
            <ul class="nav nav-pills nav-stacked collapse" id="manipulationWidgetList">
               % for widget in configs['ManipulationWidget']:
                <li>
                    <button type="button" class="btn btn-sm btn-block"
                        data-toggle="popover"
                        data-container="body"
                        data-placement="right"
                        id="${widget['name']}">
                        ${widget['name']}</button>
                    <div id="${widget['name']}-content" class="hide">
                        <p><b>Description:</b> ${widget['description']}</br>
                            % for in_key, in_val in [(key, widget[key]) for key in widget.keys() if 'input' in key]:
                                % if 'type' in in_key:
                                    <b>Type:</b> ${in_val}</br>
                                % else:
                                    <b>Input:</b> ${in_val}, 
                                % endif
                            % endfor
                    </div>
                </li>
              % endfor
            </ul>
          </ul>
        </div>
        <div class="tab-pane col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main form-horizontal" id="update_flow">
        <table class="table">
          <tr>
              <td class="col-md-4">
                <label for="flowFilePath" class="control-label">Flow File Path</label>
            </td>
            <td>
                <input type="text" class="form-control" id="flowFilePath" name="config_file_path" value="${config_file_path}" placeholder="Enter the file path for this flow">
                <button class="btn btn-primary" onclick="javascript:doCreate()">Create</button>
                <button class="btn btn-primary" onclick="javascript:doUpdate()">Update</button>
              </td>
          </tr>
        </div>
        <form id='saveForm' action="/save" method="POST">
        <div class="tab-pane col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main form-horizontal" id="add_flow">
        <table class="table">
            <tr>
                <td>
          <h4 class="sub-header">Define Flow Data</h4>
      </td>
      </tr>
      <tr>
          <td class="col-md-4">
            <label for="flowNameInput" class="control-label">Flow Name</label>
        </td>
        <td>
            <input type="text" class="form-control" id="flowNameInput" name="flow_name" value="${config['flow_name']}" placeholder="Enter a flow name">
          </td>
      </tr>
      <tr>
          <td class="col-md-4">
            <label for="logFileInput"  class="control-label">Log File</label>
           </td>
           <td>
            <input type="text" class="form-control" id="logFileInput" name="execution.log_file" value="${config['execution']['log_file']}" placeholder="Enter the path to the log file">
          </td>
      </tr>
      <tr>
          <td class="col-md-4">
            <label for="logLevelInput">Log Level</label>
        </td>
        <td>
            <select class="form-control" id="logLevelInput" name="execution.log_level" value="${config['execution']['log_level']}" placeholder="log level">
                <option value="debug"
                % if config['execution']['log_level'] == 'debug':
                    selected="selected"
                % endif
                >Debug</option>

                <option value="info"
                % if config['execution']['log_level'] == 'info':
                    selected="selected"
                % endif
                >Info</option>

                <option value="warning"
                % if config['execution']['log_level'] == 'warning':
                    selected="selected"
                % endif
                >Warning</option>

                <option value="error"
                % if config['execution']['log_level'] == 'error':
                    selected="selected"
                % endif
                >Error</option>

                <option value="critical"
                % if config['execution']['log_level'] == 'critical':
                    selected="selected"
                % endif
                >Critical</option>
            </select>
          </td>
      </tr>
      <tr>
          <td class="col-md-4">
            <label for="clobberTempFiles">Delete temporary files?</label>
        </td>
        <td>
            <input type="checkbox" class="form-control" id="clobberTempFiles" name="execution.clobber_temp_files" 
            % if config['execution']['clobber_temp_files']:
             checked
            % endif
            >
          </td>
      </tr>
      <tr>
          <td class="col-md-4">
            <label for="clobberOutputFiles">Delete output files?</label>
        </td>
        <td>
            <input type="checkbox" class="form-control" name="execution.clobber_output_files" id="clobberOutputFiles"
            % if config['execution']['clobber_output_files']:
             checked
            % endif
            >
          </td>
            </tr>
            <tr>
              <td>
                  <h4 class="sub-header">Define Input Data</h4>
              </td>
            </tr>
            <tr>
              <td class="col-md-4">
                  <label for="input.reader">Reader Widget</label>
              </td>
              <td>
                  <select class="form-control" id="input.reader" value="${config['input']['reader']}" placeholder="reader widget">
                      <option value="choose_widget">Choose Widget</option>
                     % for widget in configs['ReaderWidget']:
                      <option value="${widget['name']}"
                      % if config['input']['reader'] == widget['name']:
                          selected="selected"
                      % endif
                      >${widget['name']}</option>
                     % endfor
                  </select>
              </td>
            </tr>
            <tr>
              <td class="col-md-4">
            <label for="input.data_directory">Data Directory</label>
              </td>
              <td>
                 <input type="text" class="form-control" id="input.data_directory" name="input.data_directory" value="${config['input']['data_directory']}" placeholder="Enter directory for data">
              </td>
            </tr>
            <tr>
              <td class="col-md-4">
                  <label for="input.variable_map">Variable Map File</label>
              </td>
              <td>
                  <input type="text" class="form-control" id="input.variable_map" name="input.variable_map" value="${config['input']['variable_map']}" placeholder="Enter path to variable mapping file">
              </td>
            </tr>
            <tr>
              <td class="col-md-4">
                  <label for="input.missing_values">Missing Values</label>
              </td>
              <td>
                <div class='input-group'>
                    <input type="text" class="form-control" id="input.missing_values" name="input.missing_values" value="${config['input']['missing_values']}" placeholder='e.g. -999.99'>
                </div>
              </td>
            </tr>
            <tr>
              <td class="col-md-4">
                  <label for="input.missing_characters">Missing Characters</label>
              </td>
              <td>
                <div class='input-group'>
                    <input type="text" class="form-control" id="input.missing_characters" name="input.missing_characters" value="${config['input']['missing_characters']}" placeholder="e.g. 'na'">
                </div>
              </td>
            </tr>
            <tr>
               <td>
                   <h4 class="sub-header">Define Input Manipulations</h4>
               </td>
            </tr>
            <ul class="nav nav-pills nav-stacked collapse" id="inputWidgetList">
            % for widget in config['input']['manipulations']:
              <li>
                    <button type="button" class="btn btn-sm btn-block"
                        data-toggle="popover"
                        data-container="body"
                        data-placement="right"
                        id="in-${widget['widget']}">
                        ${widget['widget']}</button>
                    <div id="in-${widget['widget']}-content" class="hide">
                        ${widget}
                    </div>
              </li>
            % endfor
            </ul>
            <tr>
                <td>
                    <select class="form-control" id="input.manipulation" value="${config['input']['manipulations']}" placeholder="writer widget">
                       <option value="choose_widget">Choose Widget</option>
                       % for widget in configs['ManipulationWidget']:
                          <option value="${widget['name']}" onselect="addWidget()">${widget['name']}</option>
                       % endfor
                    </select>
                </td>
            </tr>
            <tr>
              <td>
                  <h4 class="sub-header">Define Output Data</h4>
              </td>
            </tr>
            <tr>
              <td class="col-md-4">
                  <label for="output.writer">Writer Widget</label>
              </td>
              <td>
                  <select class="form-control" id="output.writer" value="${config['output']['writer']}" placeholder="writer widget">
                      <option value="choose_widget">Choose Widget</option>
                     % for widget in configs['WriterWidget']:
                      <option value="${widget['name']}"
                      % if config['output']['writer'] == widget['name']:
                          selected="selected"
                      % endif
                      >${widget['name']}</option>
                     % endfor
                  </select>
              </td>
            </tr>
            <tr>
              <td class="col-md-4">
            <label for="output.data_directory">Data Directory</label>
              </td>
              <td>
                 <input type="text" class="form-control" id="output.data_directory" name="output.data_directory" value="${config['output']['data_directory']}" placeholder="Enter directory for output data">
              </td>
            </tr>
            <tr>
              <td class="col-md-4">
                  <label for="output.temp_directory">Temporary Directory</label>
              </td>
              <td>
                  <input type="text" class="form-control" id="output.temp_directory" name="output.temp_directory" value="${config['output']['temp_directory']}" placeholder="Enter directory for temporary data">
              </td>
            </tr>
            <tr>
              <td class="col-md-4">
                  <label for="output.missing_values">Missing Values</label>
              </td>
              <td>
                <div class='input-group'>
                    <input type="text" class="form-control" id="output.missing_values" name="output.missing_values" value="${config['output']['missing_values']}" placeholder='e.g. -999.99'>
                </div>
              </td>
            </tr>
            <tr>
              <td class="col-md-4">
                  <label for="output.missing_characters">Missing Characters</label>
              </td>
              <td>
                <div class='input-group'>
                   <input type="text" class="form-control" id="output.missing_characters" name="output.missing_characters" value="${config['output']['missing_characters']}" placeholder="e.g. 'na'">
                </div>
              </td>
            </tr>
              </td>
          </tr>
          <tr>
              <td><button onclick="javascript:doCreate()" type="submit" class="btn btn-primary">Save flow</button></td>
          </tr>
        </table>
    </form>
</div>
    </div>
  </body>
</html>
